#!/bin/bash

source env/install.env

echo "Installing Sample Data..."

if [[ "$INSTALL_SOURCE" == "composer" ]]; then
  bin/magento sampledata:deploy
elif [[ "$INSTALL_SOURCE" == "git" ]]; then
  FULL_HOST_INSTALL_PATH="$PWD/src"
  git clone --single-branch --branch "$MAGENTO_VERSION" git@github.com:magento/magento2-sample-data "$FULL_HOST_INSTALL_PATH"/sample-data
  bin/cli php -f /var/www/html/sample-data/dev/tools/build-sample-data.php -- --ce-source="/var/www/html"
  if [[ "$MAGENTO_EDITION" == "commerce" ]]; then
    git clone --single-branch --branch "$MAGENTO_VERSION" git@github.com:magento/magento2-sample-data-ee "$FULL_HOST_INSTALL_PATH"/magento2ee/sample-data-ee
    bin/cli php -f /var/www/html/sample-data-ee/dev/tools/build-sample-data.php -- --ce-source="/var/www/html" --ee-source="/var/www/html/magento2ee"
  fi
  bin/copyfromcontainer app
fi

bin/magento setup:upgrade
bin/magento setup:di:compile
