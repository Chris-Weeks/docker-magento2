#!/bin/bash
__dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
docker-compose -f "${__dir}/../docker-compose.yml" -f "${__dir}/../docker-compose.dev.yml" \
  exec -T -u root app mkcert -install
docker cp "$(docker-compose -f "${__dir}/../docker-compose.yml" -f "${__dir}/../docker-compose.dev.yml" \
  ps -q app|awk '{print $1}')":/root/.local/share/mkcert/rootCA.pem .
echo "System password requested to install certificate authority on host..."

if [ "$(uname)" == "Darwin" ]; then
  sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain rootCA.pem
  rm rootCA.pem
else
  sudo mv rootCA.pem /usr/local/share/ca-certificates/rootCA.pem
  sudo update-ca-certificates
fi
