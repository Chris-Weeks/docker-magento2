#!/bin/bash

STORES=$(bin/n98-magerun2 sys:store:list --format=json | grep -iv warning | jq)

echo | tee -a /etc/hosts
for STORE_ID in $(echo "$STORES" | jq -r '.[].id'); do
    SEPARATOR=""
    STORE_CODE=""
    if [[ ${STORE_ID} -gt 1 ]]; then
        SEPARATOR="-"
        STORE_CODE=$(echo "$STORES" | jq -r ".[\"$STORE_ID\"].code")
        STORE_CODE=$(echo "$STORE_CODE" | sed -e 's/_/-/g')
    fi
    HOSTS_URL=magento"${SEPARATOR}""${STORE_CODE}".test
    URL_IN_HOSTS_FILE=$(grep -c "$HOSTS_URL" /etc/hosts)
    if [[ $URL_IN_HOSTS_FILE -eq 0 ]]; then

        echo 127.0.0.1"$(printf "\t")""$HOSTS_URL" | tee -a /etc/hosts
    fi

done
